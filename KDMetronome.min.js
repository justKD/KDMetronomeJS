const _KDMetronomeInit={cdn:{tonejs:"https://cdnjs.cloudflare.com/ajax/libs/tone/14.3.32/Tone.js",nexusui:"https://cdn.jsdelivr.net/npm/nexusui@2.0.10/dist/NexusUI.min.js",animate:"https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css"},scriptTags:{tone:"kdmetronome--tonejs--script",nexus:"kdmetronome--nexusui--script",animate:"kdmetronome--animatecss--style",style:"kdmetronome--styles"},cssClassNames:{outerContainer:"kdmetronome--outer-container",innerContainer:"kdmetronome--inner-container",startButton:"kdmetronome--start-button",bpmWidgetOuter:"kdmetronome--bpm-widget-outer",volWidgetOuter:"kdmetronome--vol-widget-outer",widgetTextLabel:"kdmetronome--widget-text-label"},state:{toneLoaded:!1,nexusLoaded:!1,ready:!1},createCSS:e=>{const t={outerContainer:" ."+_KDMetronomeInit.cssClassNames.outerContainer+" { opacity: 1; position: fixed; display: none; left: 80px; bottom: 80px; flex-wrap: wrap; justify-content: center; align-items: center; align-content: center;}",innerContainer:" ."+_KDMetronomeInit.cssClassNames.innerContainer+"{ background-color: #ffffff; padding: 20px; display: flex; flex-wrap: no-wrap; justify-content: center; align-items: center; align-content: center; border-radius: 3px; box-shadow: 0 2px 7px 0 rgba(0, 0, 0, .5); -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}",startButton:" ."+_KDMetronomeInit.cssClassNames.startButton+"{ display: inline-block; height: 54px; width: 60px ;background-color: rgb(38, 38, 38); color: #ffffff; cursor: pointer; margin-right: 30px; opacity: 1; font-weight: 400; text-align: center; vertical-align: middle; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; -khtml-user-select: none; border: none; padding: .375rem .75rem; font-size: 1rem; line-height: 1.5; border-radius: .25rem; transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out; outline: none !important; text-transform: none; overflow: visible; -webkit-appearance: button;}",bpmWidgetOuter:" ."+_KDMetronomeInit.cssClassNames.bpmWidgetOuter+"{ -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; margin-right: 30px; border-radius: 3px; overflow: hidden;}",volWidgetOuter:" ."+_KDMetronomeInit.cssClassNames.volWidgetOuter+"{ -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; border-radius: 3px; overflow: hidden;}",widgetTextLabel:" ."+_KDMetronomeInit.cssClassNames.widgetTextLabel+"{ text-align: center; background-color: #262626; color: #ffffff; line-height: 1.5;}",noTransition:".no-transition { -webkit-transition: 0s -webkit-filter linear; -moz-transition: 0s -moz-filter linear; -moz-transition: 0s filter linear; -ms-transition: 0s -ms-filter linear; -o-transition: 0s -o-filter linear; transition: 0s filter linear, 0s -webkit-filter linear;}"};let n="";Object.values(t).forEach(e=>n+=e);document.getElementById(_KDMetronomeInit.scriptTags.style)||(e=>{const t=document.createElement("style");t.id=_KDMetronomeInit.scriptTags.style,t.appendChild(document.createTextNode(n)),document.head.appendChild(t)})()},readyCheck:e=>{if(_KDMetronomeInit.state.toneLoaded&&_KDMetronomeInit.state.nexusLoaded)_KDMetronomeInit.state.ready||(_KDMetronomeInit.state.ready=!0);else{let e=0;setTimeout(()=>{e<2e3?(e++,_KDMetronomeInit.readyCheck()):console.log("Unable to load KDMetronome dependencies.")},100)}},checkTone:e=>{"undefined"!=typeof Tone&&(_KDMetronomeInit.state.toneLoaded=!0),_KDMetronomeInit.readyCheck()},checkNexus:e=>{"undefined"!=typeof Nexus&&(_KDMetronomeInit.state.nexusLoaded=!0),_KDMetronomeInit.readyCheck()},loadToneJS:e=>{const t=document.createElement("script");t.id=_KDMetronomeInit.scriptTags.tone,t.src=_KDMetronomeInit.cdn.tonejs,t.onload=(e=>_KDMetronomeInit.checkTone()),document.body.appendChild(t)},loadNexusUI:e=>{const t=document.createElement("script");t.id=_KDMetronomeInit.scriptTags.nexus,t.src=_KDMetronomeInit.cdn.nexusui,t.onload=(e=>_KDMetronomeInit.checkNexus()),document.body.appendChild(t)},loadAnimateCSS:e=>{const t=document.createElement("link");t.id=_KDMetronomeInit.scriptTags.animate,t.rel="stylesheet",t.href=_KDMetronomeInit.cdn.animate,document.head.appendChild(t)},init:e=>{_KDMetronomeInit.createCSS(),_KDMetronomeInit.loadAnimateCSS(),_KDMetronomeInit.loadToneJS(),_KDMetronomeInit.loadNexusUI()}};Object.freeze(_KDMetronomeInit),_KDMetronomeInit.init();class KDMetronome{constructor(e,t){const n=(e=>{let t=(new Date).getTime(),n=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let o=16*Math.random();return t>0?(o=(t+o)%16|0,t=Math.floor(t/16)):(o=(n+o)%16|0,n=Math.floor(n/16)),("x"===e?o:3&o|8).toString(16)})})(),o=(e,t,n)=>{const o=document.querySelector("#"+e);o.classList.add("animated",t);const s=e=>{o.classList.remove("animated",t),o.removeEventListener("animationend",s),"function"==typeof n&&n()};o.addEventListener("animationend",s)},s={uuid:n,domIDs:{toggle:"object"==typeof e?null:e,container:"kdmetronome--outer-"+n,inner:"kdmetronome--inner-"+n,startButton:"kdmetronome--startbutton-"+n,bpmWidget:"kdmetronome--bpmwidget-"+n,volWidget:"kdmetronome--volwidget-"+n},styles:{fontFamily:"Roboto Condensed, Trebuchet MS, Lucida Sans Unicode, Lucida Grande, Lucida Sans, Arial, sans-serif",black:"#262626",green:"#1dd1a1",grey:"#eeeeee"},bounds:{bpm:{min:6,max:300},volume:{min:0,max:100}},defaults:{volume:50,bpm:72,frequency:600}},i={bpm:t||s.defaults.bpm,volume:s.defaults.volume,frequency:s.defaults.frequency,headless:!1},l={context:null,clock:null,event:null},r={synth:null,bpmWidget:null,volumeWidget:null};let d=e=>g();const a=e=>{e.headless&&u(e.headless),e.toggleID&&(s.domIDs.toggle=e.toggleID),e.bpm&&(i.bpm=e.bpm),e.volume&&(i.volume=e.volume),e.frequency&&(i.frequency=e.frequency)},m=e=>{l.event&&this.stop(),l.context=window.webkitAudioContext?new webkitAudioContext:new AudioContext,l.clock=new WAAClock(l.context),l.clock.start();const t=document.getElementById(s.domIDs.startButton);t&&(t.style.backgroundColor=s.styles.green,t.innerHTML="on",t.classList.add("noTransition"));const n=60/i.bpm;l.event=l.clock.callbackAtTime(e=>d(),n).repeat(n),r.synth.volume.value=Tone.gainToDb(i.volume/100),d()},c=e=>(e&&(this.running()&&this.stop(),i.bpm=e),i.bpm),u=e=>{if("boolean"==typeof e){i.headless=e;const t=document.getElementById(s.domIDs.container);t&&t.parentNode.removeChild(t)}return i.headless},y=e=>{if(_KDMetronomeInit.state.ready)p();else{let e=0;setTimeout(()=>{e<2e3?(e++,y()):console.log("unable to create metronome")},100)}},g=((t=>{(e=>{(e=>{const t=document.createElement("div");t.id=s.domIDs.container,document.body.appendChild(t)})(),(e=>{const t=document.getElementById(s.domIDs.container);t.classList.add(_KDMetronomeInit.cssClassNames.outerContainer),t.innerHTML="<div id='"+s.domIDs.inner+"'></div>"})(),(e=>{const t=document.getElementById(s.domIDs.inner);t.classList.add(_KDMetronomeInit.cssClassNames.innerContainer),t.innerHTML="<button id='"+s.domIDs.startButton+"' class='"+_KDMetronomeInit.cssClassNames.startButton+"' type='button'>off</button><div class='"+_KDMetronomeInit.cssClassNames.bpmWidgetOuter+"'><div id='"+s.domIDs.bpmWidget+"'></div><div class='"+_KDMetronomeInit.cssClassNames.widgetTextLabel+"'>bpm</div></div><div class='"+_KDMetronomeInit.cssClassNames.volWidgetOuter+"'><div id='"+s.domIDs.volWidget+"'></div><div class='"+_KDMetronomeInit.cssClassNames.widgetTextLabel+"'>vol</div></div>"})()})();"object"==typeof e&&a(e),y()})(),e=>{r.synth.triggerAttackRelease(i.frequency,"8n");const t=document.getElementById(s.domIDs.startButton);t&&(t.style.opacity<1?t.style.opacity=1:t.style.opacity=.7)}),p=e=>{(e=>{r.synth=new Tone.Synth({oscillator:{type:"sine",modulationFrequency:.4},envelope:{attack:0,decay:.05,sustain:0,release:.1}}).toDestination(),r.synth.volume.value=Tone.gainToDb(i.volume/100)})(),(e=>{if(document.getElementById(s.domIDs.container)){const e="#"+s.domIDs.bpmWidget;r.bpmWidget=new Nexus.Number(e,{size:[60,30],value:i.bpm,min:s.bounds.bpm.min,max:s.bounds.bpm.max,step:1}),r.bpmWidget.on("change",e=>{this.bpm(e)}),Object.values(document.getElementById(s.domIDs.bpmWidget).children).forEach(e=>{e.style.textAlign="center",e.style.backgroundColor=s.styles.grey,e.style.color=s.styles.black,e.style.fontFamily=s.styles.fontFamily})}})(),(e=>{if(document.getElementById(s.domIDs.container)){const e="#"+s.domIDs.volWidget;r.volumeWidget=new Nexus.Number(e,{size:[60,30],value:i.volume,min:s.bounds.volume.min,max:s.bounds.volume.max,step:1}),r.volumeWidget.on("change",e=>{r.synth.volume.value=Tone.gainToDb(e/100),i.volume=e}),Object.values(document.getElementById(s.domIDs.volWidget).children).forEach(e=>{e.style.textAlign="center",e.style.backgroundColor=s.styles.grey,e.style.color=s.styles.black,e.style.fontFamily=s.styles.fontFamily})}})();document.getElementById(s.domIDs.container)&&(document.getElementById(s.domIDs.container).style.display="none",document.getElementById(s.domIDs.startButton).style.opacity=1,s.domIDs.toggle&&document.getElementById(s.domIDs.toggle).addEventListener("click",e=>this.hidden()?this.show():this.hide()),document.getElementById(s.domIDs.startButton).addEventListener("click",e=>l.event?this.stop():this.start()),(e=>{const t=[0,0,0,0],n=e=>{document.onmouseup=null,document.onmousemove=null},o=n=>{(n=n||window.event).preventDefault(),(e=>{t[0]=t[2]-n.clientX,t[1]=t[3]-2*n.clientY,t[2]=n.clientX,t[3]=2*n.clientY})(),(n=>{const o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,l=document.getElementById(s.domIDs.inner);let r=e.offsetTop-t[1],d=e.offsetLeft-t[0];r=Math.min(Math.max(r,-i+l.clientHeight),i),d=Math.min(Math.max(d,0),o-l.clientWidth),e.style.top=r+"px",e.style.left=d+"px"})()};e.onmousedown=(e=>{(e=e||window.event).preventDefault(),(n=>{t[2]=e.clientX,t[3]=2*e.clientY})(),(e=>{document.onmouseup=n,document.onmousemove=o})()})})(document.getElementById(s.domIDs.container)))};this.callback=(e=>(e=>{"function"==typeof e?d=e:"default"===e&&(d=(e=>g()))})(e)),this.setOptions=(e=>a(e)),this.start=(e=>m()),this.stop=(e=>(e=>{l.clock.stop(),l.event.clear(),l.context.close(),l.event=null,l.clock=null,l.context=null;const t=document.getElementById(s.domIDs.startButton);t&&(t.classList.remove("noTransition"),t.style.backgroundColor=s.styles.black,t.style.opacity=1,t.innerHTML="off")})()),this.hide=(e=>(e=>{document.getElementById(s.domIDs.container)?o(s.domIDs.container,"bounceOutLeft",e=>document.getElementById(s.domIDs.container).style.display="none"):console.log("unable to hide: headless mode")})()),this.show=(e=>(e=>{document.getElementById(s.domIDs.container)?(document.getElementById(s.domIDs.container).style.display="flex",o(s.domIDs.container,"bounceInLeft")):console.log("unable to show: headless mode")})()),this.running=(e=>(e=>!!l.event)()),this.bpm=(e=>c(e)),this.volume=(e=>(e=>(e&&(i.volume=e),i.volume))(e)),this.frequency=(e=>(e=>(e&&(i.frequency=e),i.frequency))(e)),this.hidden=(e=>(e=>{const t=document.getElementById(s.domIDs.container);let n="undefined";return t&&(n="none"==t.style.display),n})()),this.headless=(e=>u(e)),this.state=(e=>(e=>i)()),this.props=(e=>(e=>s)()),this.controllers=(e=>(e=>l)()),this.views=(e=>(e=>r)()),this.uuid=(e=>n)}}