class KDMetronome{constructor(e,t){this.props={scriptTags:{tone:"kdmetronome--tonejs--script",nexus:"kdmetronome--nexusui--script",animate:"kdmetronome--animatecss--style",style:"kdmetronome--styles"},cdn:{tonejs:"https://cdnjs.cloudflare.com/ajax/libs/tone/14.3.32/Tone.js",nexusui:"https://cdn.jsdelivr.net/npm/nexusui@2.0.10/dist/NexusUI.min.js",animate:"https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css"},domIDs:{toggle:e,container:"kdmetronome--outer",inner:"kdmetronome--inner",startButton:"kdmetronome--startbutton",bpmWidget:"kdmetronome--bpmwidget",volWidget:"kdmetronome--volwidget"},styles:{fontFamily:"Roboto Condensed, Trebuchet MS, Lucida Sans Unicode, Lucida Grande, Lucida Sans, Arial, sans-serif",black:"#262626",green:"#1dd1a1",grey:"#eeeeee"},bounds:{bpm:{min:6,max:300},volume:{min:1,max:100}},defaults:{volume:50,bpm:72,frequency:600},cssClassNames:{outerContainer:"kdmetronome--outer-container",innerContainer:"kdmetronome--inner-container",startButton:"kdmetronome--start-button",bpmWidgetOuter:"kdmetronome--bpm-widget-outer",volWidgetOuter:"kdmetronome--vol-widget-outer",widgetTextLabel:"kdmetronome--widget-text-label"}},this.state={toneLoaded:!1,nexusLoaded:!1,ready:!1,bpm:t||this.props.defaults.bpm,volume:this.props.defaults.volume,frequency:this.props.defaults.frequency},this.controllers={context:null,clock:null,event:null},this.views={synth:null,bpm:null,volume:null},this.createMetronome=(e=>{(e=>{this.views.synth=new Tone.Synth({oscillator:{type:"sine",modulationFrequency:.4},envelope:{attack:0,decay:.05,sustain:0,release:.1}}).toDestination(),this.views.synth.volume.value=Tone.gainToDb(this.state.volume/100)})(),(e=>{if(document.getElementById(this.props.domIDs.container)){const e="#"+this.props.domIDs.bpmWidget;this.views.bpmWidget=new Nexus.Number(e,{size:[60,30],value:this.state.bpm,min:this.props.bounds.bpm.min,max:this.props.bounds.bpm.max,step:1}),this.views.bpmWidget.on("change",e=>{this.setBPM(e)}),Object.values(document.getElementById(this.props.domIDs.bpmWidget).children).forEach(e=>{e.style.textAlign="center",e.style.backgroundColor=this.props.styles.grey,e.style.color=this.props.styles.black,e.style.fontFamily=this.props.styles.fontFamily})}})(),(e=>{if(document.getElementById(this.props.domIDs.container)){const e="#"+this.props.domIDs.volWidget;this.views.volumeWidget=new Nexus.Number(e,{size:[60,30],value:this.state.volume,min:this.props.bounds.volume.min,max:this.props.bounds.volume.max,step:1}),this.views.volumeWidget.on("change",e=>{this.views.synth.volume.value=Tone.gainToDb(e/100),this.state.volume=e}),Object.values(document.getElementById(this.props.domIDs.volWidget).children).forEach(e=>{e.style.textAlign="center",e.style.backgroundColor=this.props.styles.grey,e.style.color=this.props.styles.black,e.style.fontFamily=this.props.styles.fontFamily})}})();document.getElementById(this.props.domIDs.container)&&(document.getElementById(this.props.domIDs.container).style.display="none",document.getElementById(this.props.domIDs.startButton).style.opacity=1,this.props.domIDs.toggle&&document.getElementById(this.props.domIDs.toggle).addEventListener("click",e=>this.isHidden()?this.show():this.hide()),document.getElementById(this.props.domIDs.startButton).addEventListener("click",e=>this.controllers.event?this.stop():this.start()),this.draggable(document.getElementById(this.props.domIDs.container)))});(e=>{(e=>{const t={outerContainer:" ."+this.props.cssClassNames.outerContainer+" { opacity: 1; position: fixed; display: none; left: 80px; bottom: 80px; flex-wrap: wrap; justify-content: center; align-items: center; align-content: center;}",innerContainer:" ."+this.props.cssClassNames.innerContainer+"{ background-color: #ffffff; padding: 20px; display: flex; flex-wrap: no-wrap; justify-content: center; align-items: center; align-content: center; border-radius: 3px; box-shadow: 0 2px 7px 0 rgba(0, 0, 0, .5); -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}",startButton:" ."+this.props.cssClassNames.startButton+"{ display: inline-block; height: 54px; width: 60px ;background-color: rgb(38, 38, 38); color: #ffffff; cursor: pointer; margin-right: 30px; opacity: 1; font-weight: 400; text-align: center; vertical-align: middle; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; -khtml-user-select: none; border: none; padding: .375rem .75rem; font-size: 1rem; line-height: 1.5; border-radius: .25rem; transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out; outline: none !important; text-transform: none; overflow: visible; -webkit-appearance: button;}",bpmWidgetOuter:" ."+this.props.cssClassNames.bpmWidgetOuter+"{ -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; margin-right: 30px; border-radius: 3px; overflow: hidden;}",volWidgetOuter:" ."+this.props.cssClassNames.volWidgetOuter+"{ -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; border-radius: 3px; overflow: hidden;}",widgetTextLabel:" ."+this.props.cssClassNames.widgetTextLabel+"{ text-align: center; background-color: #262626; color: #ffffff; line-height: 1.5;}",noTransition:".no-transition { -webkit-transition: 0s -webkit-filter linear; -moz-transition: 0s -moz-filter linear; -moz-transition: 0s filter linear; -ms-transition: 0s -ms-filter linear; -o-transition: 0s -o-filter linear; transition: 0s filter linear, 0s -webkit-filter linear;}"};let s="";Object.values(t).forEach(e=>s+=e);document.getElementById(this.props.scriptTags.style)||(e=>{const t=document.createElement("style");t.id=this.props.scriptTags.style,t.appendChild(document.createTextNode(s)),document.head.appendChild(t)})()})(),(e=>{(e=>{const t=document.createElement("div");t.id=this.props.domIDs.container,document.body.appendChild(t)})(),(e=>{const t=document.getElementById(this.props.domIDs.container);t.classList.add(this.props.cssClassNames.outerContainer),t.innerHTML="<div id='"+this.props.domIDs.inner+"'></div>"})(),(e=>{const t=document.getElementById(this.props.domIDs.inner);t.classList.add(this.props.cssClassNames.innerContainer),t.innerHTML="<button id='"+this.props.domIDs.startButton+"' class='"+this.props.cssClassNames.startButton+"' type='button'>off</button><div class='"+this.props.cssClassNames.bpmWidgetOuter+"'><div id='"+this.props.domIDs.bpmWidget+"'></div><div class='"+this.props.cssClassNames.widgetTextLabel+"'>bpm</div></div><div class='"+this.props.cssClassNames.volWidgetOuter+"'><div id='"+this.props.domIDs.volWidget+"'></div><div class='"+this.props.cssClassNames.widgetTextLabel+"'>vol</div></div>"})()})();const t=e=>{if(this.state.toneLoaded&&this.state.nexusLoaded)this.state.ready||(this.state.ready=!0,this.createMetronome());else{let e=0;setTimeout(()=>{e<2e3?(e++,t()):console.log("unable to create metronome")},100)}},s=e=>{"undefined"!=typeof Tone&&(this.state.toneLoaded=!0),t()},o=e=>{"undefined"!=typeof Nexus&&(this.state.nexusLoaded=!0),t()};!document.getElementById(this.props.scriptTags.animate)&&(e=>{const t=document.createElement("link");t.id=this.props.scriptTags.animate,t.rel="stylesheet",t.href=this.props.cdn.animate,document.head.appendChild(t)})(),document.getElementById(this.props.scriptTags.tone)?s():(e=>{const t=document.createElement("script");t.id=this.props.scriptTags.tone,t.src=this.props.cdn.tonejs,t.onload=(e=>s()),document.body.appendChild(t)})(),document.getElementById(this.props.scriptTags.nexus)?o():(e=>{const t=document.createElement("script");t.id=this.props.scriptTags.nexus,t.src=this.props.cdn.nexusui,t.onload=(e=>o()),document.body.appendChild(t)})()})()}start(){this.controllers.event&&this.stop(),this.controllers.context=window.webkitAudioContext?new webkitAudioContext:new AudioContext,this.controllers.clock=new WAAClock(this.controllers.context),this.controllers.clock.start();const e=document.getElementById(this.props.domIDs.startButton);e&&(e.style.backgroundColor=this.props.styles.green,e.innerHTML="on",e.classList.add("noTransition"));const t=60/this.state.bpm;this.controllers.event=this.controllers.clock.callbackAtTime(e=>this.callback(),t).repeat(t),this.views.synth.volume.value=Tone.gainToDb(this.state.volume/100),this.views.synth.triggerAttackRelease(this.state.frequency,"8n")}stop(){this.controllers.clock.stop(),this.controllers.event.clear(),this.controllers.context.close(),this.controllers.event=null,this.controllers.clock=null,this.controllers.context=null;const e=document.getElementById(this.props.domIDs.startButton);e&&(e.classList.remove("noTransition"),e.style.backgroundColor=this.props.styles.black,e.style.opacity=1,e.innerHTML="off")}callback(){this.views.synth.triggerAttackRelease(this.state.frequency,"8n");const e=document.getElementById(this.props.domIDs.startButton);e&&(e.style.opacity<1?e.style.opacity=1:e.style.opacity=.7)}hide(){document.getElementById(this.props.domIDs.container)?this.animateCSS(this.props.domIDs.container,"bounceOutLeft",e=>document.getElementById(this.props.domIDs.container).style.display="none"):console.log("headless mode")}show(){document.getElementById(this.props.domIDs.container)?(document.getElementById(this.props.domIDs.container).style.display="flex",this.animateCSS(this.props.domIDs.container,"bounceInLeft")):console.log("headless mode")}isOn(){return!!this.controllers.event}setBPM(e){this.isOn()&&this.stop(),this.state.bpm=e}setVolume(e){this.state.volume=e}setFrequency(e){this.state.frequency=e}isHidden(){const e=document.getElementById(this.props.domIDs.container);let t="undefined";return e&&(t="none"==e.style.display),t}headless(){const e=document.getElementById(this.props.domIDs.container);e&&e.parentNode.removeChild(e)}animateCSS(e,t,s){const o=document.querySelector("#"+e);o.classList.add("animated",t);const n=e=>{o.classList.remove("animated",t),o.removeEventListener("animationend",n),"function"==typeof s&&s()};o.addEventListener("animationend",n)}draggable(e){const t=[0,0,0,0],s=this;function o(o){(o=o||window.event).preventDefault();t[0]=t[2]-o.clientX,t[1]=t[3]-2*o.clientY,t[2]=o.clientX,t[3]=2*o.clientY,(o=>{const n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,r=document.getElementById(s.props.domIDs.inner);let l=e.offsetTop-t[1],a=e.offsetLeft-t[0];l=Math.min(Math.max(l,-i+r.clientHeight),i),a=Math.min(Math.max(a,0),n-r.clientWidth),e.style.top=l+"px",e.style.left=a+"px"})()}function n(){document.onmouseup=null,document.onmousemove=null}e.onmousedown=function(e){(e=e||window.event).preventDefault();t[2]=e.clientX,t[3]=2*e.clientY,document.onmouseup=n,document.onmousemove=o}}}