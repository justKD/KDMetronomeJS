const _KDMetronomeInit={cdn:{tonejs:"https://cdnjs.cloudflare.com/ajax/libs/tone/14.3.32/Tone.js",nexusui:"https://cdn.jsdelivr.net/npm/nexusui@2.0.10/dist/NexusUI.min.js",animate:"https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css"},scriptTags:{tone:"kdmetronome--tonejs--script",nexus:"kdmetronome--nexusui--script",animate:"kdmetronome--animatecss--style",style:"kdmetronome--styles"},cssClassNames:{outerContainer:"kdmetronome--outer-container",innerContainer:"kdmetronome--inner-container",startButton:"kdmetronome--start-button",bpmWidgetOuter:"kdmetronome--bpm-widget-outer",volWidgetOuter:"kdmetronome--vol-widget-outer",widgetTextLabel:"kdmetronome--widget-text-label"},state:{toneLoaded:!1,nexusLoaded:!1,ready:!1},createCSS:e=>{const t={opacity:1,position:"fixed",display:"none",left:"80px",bottom:"80px","flex-wrap":"wrap","justify-content":"center","align-items":"center","align-content":"center"},n={padding:"20px",display:"flex","background-color":"#ffffff","flex-wrap":"no-wrap","justify-content":"center","align-items":"center","align-content":"center","border-radius":"3px","box-shadow":"0 2px 7px 0 rgba(0, 0, 0, .5)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},o={display:"inline-block",border:"none",padding:".375rem .75rem",height:"54px",width:"60px",opacity:"1",color:"#ffffff",cursor:"pointer",outline:"none !important",overflow:"visible","font-weight":"400","font-size":"1rem","line-height":"1.5","margin-right":"30px","border-radius":".25rem","background-color":"rgb(38, 38, 38)","text-align":"center","vertical-align":"middle","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","text-transform":"none","-webkit-appearance":"button",transition:"color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out"},s={overflow:"hidden","margin-right":"30px","border-radius":"3px","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},i={overflow:"hidden","border-radius":"3px","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},l={color:"#ffffff","line-height":"1.5","text-align":"center","background-color":"#262626"},a={"-webkit-transition":"0s -webkit-filter linear","-moz-transition":"0s -moz-filter linear","-moz-transition":"0s filter linear","-ms-transition":"0s -ms-filter linear","-o-transition":"0s -o-filter linear",transition:"0s filter linear, 0s -webkit-filter linear"},r=e=>{let t=" {";return Object.keys(e).forEach(n=>t+=n+": "+e[n]+";"),t+="}"},d={outerContainer:" ."+_KDMetronomeInit.cssClassNames.outerContainer+r(t),innerContainer:" ."+_KDMetronomeInit.cssClassNames.innerContainer+r(n),startButton:" ."+_KDMetronomeInit.cssClassNames.startButton+r(o),bpmWidgetOuter:" ."+_KDMetronomeInit.cssClassNames.bpmWidgetOuter+r(s),volWidgetOuter:" ."+_KDMetronomeInit.cssClassNames.volWidgetOuter+r(i),widgetTextLabel:" ."+_KDMetronomeInit.cssClassNames.widgetTextLabel+r(l),noTransition:".no-transition"+r(a)};let m="";Object.values(d).forEach(e=>m+=e);document.getElementById(_KDMetronomeInit.scriptTags.style)||(e=>{const t=document.createElement("style");t.id=_KDMetronomeInit.scriptTags.style,t.appendChild(document.createTextNode(m)),document.head.appendChild(t)})()},readyCheck:e=>{if(_KDMetronomeInit.state.toneLoaded&&_KDMetronomeInit.state.nexusLoaded)if(_KDMetronomeInit.state.ready){let e=0;setTimeout(t=>{e<2e3?(e++,_KDMetronomeInit.readyCheck()):console.log("Unable to load KDMetronome dependencies.")},100)}else _KDMetronomeInit.state.ready=!0},checkTone:e=>{"undefined"!=typeof Tone&&(_KDMetronomeInit.state.toneLoaded=!0),_KDMetronomeInit.readyCheck()},checkNexus:e=>{"undefined"!=typeof Nexus&&(_KDMetronomeInit.state.nexusLoaded=!0),_KDMetronomeInit.readyCheck()},loadToneJS:e=>{const t=document.createElement("script");t.id=_KDMetronomeInit.scriptTags.tone,t.src=_KDMetronomeInit.cdn.tonejs,t.onload=(e=>_KDMetronomeInit.checkTone()),document.body.appendChild(t)},loadNexusUI:e=>{const t=document.createElement("script");t.id=_KDMetronomeInit.scriptTags.nexus,t.src=_KDMetronomeInit.cdn.nexusui,t.onload=(e=>_KDMetronomeInit.checkNexus()),document.body.appendChild(t)},loadAnimateCSS:e=>{const t=document.createElement("link");t.id=_KDMetronomeInit.scriptTags.animate,t.rel="stylesheet",t.href=_KDMetronomeInit.cdn.animate,document.head.appendChild(t)},init:e=>{_KDMetronomeInit.createCSS(),e?Object.values(_KDMetronomeInit.state).forEach(e=>!0):(_KDMetronomeInit.loadAnimateCSS(),_KDMetronomeInit.loadToneJS(),_KDMetronomeInit.loadNexusUI())}};Object.freeze(_KDMetronomeInit),_KDMetronomeInit.init();class KDMetronome{constructor(e,t){const n={createUUID:e=>{let t=(new Date).getTime(),n=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let o=16*Math.random();return t>0?(o=(t+o)%16|0,t=Math.floor(t/16)):(o=(n+o)%16|0,n=Math.floor(n/16)),("x"===e?o:3&o|8).toString(16)})},animateCSS:(e,t,n)=>{const o=document.querySelector("#"+e);o.classList.add("animated",t);const s=e=>{o.classList.remove("animated",t),o.removeEventListener("animationend",s),"function"==typeof n&&n()};o.addEventListener("animationend",s)},clip:(e,t,n)=>Math.min(Math.max(t,e),n),makeDraggable:e=>{const t=[0,0,0,0],s=e=>{document.onmouseup=null,document.onmousemove=null},i=s=>{(s=s||window.event).preventDefault();(e=>{t[0]=t[2]-s.clientX,t[1]=t[3]-2*s.clientY,t[2]=s.clientX,t[3]=2*s.clientY})(),(s=>{const i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,l=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,a=document.getElementById(o.domIDs.inner);let r=e.offsetTop-t[1],d=e.offsetLeft-t[0];r=n.clip(r,-l+a.clientHeight,l),d=n.clip(d,0,i-a.clientWidth),e.style.top=r+"px",e.style.left=d+"px"})()};e.onmousedown=(e=>{(e=e||window.event).preventDefault();(n=>{t[2]=e.clientX,t[3]=2*e.clientY})(),(e=>{document.onmouseup=s,document.onmousemove=i})()})}},o={uuid:n.createUUID(),domIDs:{},styles:{fontFamily:"Roboto Condensed, Trebuchet MS, Lucida Sans Unicode, Lucida Grande, Lucida Sans, Arial, sans-serif",black:"#262626",green:"#1dd1a1",grey:"#eeeeee"},bounds:{bpm:{min:6,max:300},volume:{min:0,max:100},hz:{min:20,max:20500}},defaults:{volume:50,volumeScale:1.6,bpm:72,frequency:600,callback:e=>{this.triggerSynth(),r.startButtonVisualFeedback()}},callback:e=>o.defaults.callback()};o.domIDs={parentContainer:t||"kdmetronome--body",toggle:"object"==typeof e?null:e,container:"kdmetronome--outer-"+o.uuid,inner:"kdmetronome--inner-"+o.uuid,startButton:"kdmetronome--startbutton-"+o.uuid,bpmWidget:"kdmetronome--bpmwidget-"+o.uuid,volWidget:"kdmetronome--volwidget-"+o.uuid};const s={ready:!1,bpm:o.defaults.bpm,volume:o.defaults.volume,frequency:o.defaults.frequency,headless:!1,ticks:0},i={context:null,clock:null,event:null},l={synth:null,bpmWidget:null,volumeWidget:null};let a={callback:e=>{"function"==typeof e?o.callback=e:"default"===e&&(o.callback=(e=>o.defaults.callback()))},setOptions:e=>{e.toggleID&&(o.domIDs.toggle=e.toggleID),e.headless&&this.headless(e.headless),e.bpm&&this.bpm(e.bpm),e.volume&&this.volume(e.volume),e.frequency&&this.frequency(e.frequency)},start:e=>{i.event&&this.stop(),i.context=window.webkitAudioContext?new webkitAudioContext:new AudioContext,i.clock=new WAAClock(i.context),i.clock.start();const t=document.getElementById(o.domIDs.startButton);t&&(t.style.backgroundColor=o.styles.green,t.innerHTML="on",t.classList.add("noTransition"));const n=60/s.bpm;i.event=i.clock.callbackAtTime(e=>{s.ticks++,o.callback()},n).repeat(n)},stop:e=>{i.clock.stop(),i.event.clear(),i.context.close(),i.event=null,i.clock=null,i.context=null,s.ticks=0;const t=document.getElementById(o.domIDs.startButton);t&&(t.classList.remove("noTransition"),t.style.backgroundColor=o.styles.black,t.style.opacity=1,t.innerHTML="off")},hide:e=>{const t=document.getElementById(o.domIDs.container);t?n.animateCSS(o.domIDs.container,"bounceOutLeft",e=>t.style.display="none"):console.log("N/A: headless mode")},show:e=>{const t=document.getElementById(o.domIDs.container);t?(t.style.display="flex",n.animateCSS(o.domIDs.container,"bounceInLeft")):console.log("N/A: headless mode")},running:e=>!!i.event,bpm:e=>("number"==typeof e&&s.bpm!=e&&(l.bpmWidget.value=n.clip(e,o.bounds.bpm.min,o.bounds.bpm.max)),s.bpm),volume:e=>("number"==typeof e&&s.volume!=e&&(l.volumeWidget.value=n.clip(e,o.bounds.volume.min,o.bounds.volume.max)),s.volume),frequency:e=>("number"==typeof e&&(s.frequency=n.clip(e,o.bounds.hz.min,o.bounds.hz.max)),s.frequency),hidden:e=>{const t=document.getElementById(o.domIDs.container);return t?"none"==t.style.display:null},headless:e=>{if("boolean"==typeof e){s.headless=e;const t=document.getElementById(o.domIDs.container);t&&t.parentNode.removeChild(t)}return s.headless},triggerSynth:e=>l.synth.triggerAttackRelease(s.frequency,"8n"),ticks:e=>s.ticks,state:e=>s,props:e=>o,views:e=>l,controllers:e=>i,ready:e=>{if("function"==typeof e)if(s.ready)e();else{let t=0;setTimeout(n=>{t<2e3?(t++,this.ready(e)):console.log("Unable to create metronome.")},100)}return s.ready}};const r={readyCheck:e=>{if(_KDMetronomeInit.state.ready)r.createMetronome(),s.ready=!0;else{let e=0;setTimeout(t=>{e<2e3?(e++,r.readyCheck()):console.log("Unable to create metronome.")},100)}},startButtonVisualFeedback:e=>{const t=document.getElementById(o.domIDs.startButton);t&&(t.style.opacity<1?t.style.opacity=1:t.style.opacity=.7)},createMetronome:t=>{(e=>{l.synth=new Tone.Synth({oscillator:{type:"sine",modulationFrequency:.4},envelope:{attack:0,decay:.05,sustain:0,release:.1}}).toDestination(),l.synth.volume.value=Tone.gainToDb(s.volume*o.defaults.volumeScale/100)})(),(e=>{if(document.getElementById(o.domIDs.container)){const e="#"+o.domIDs.bpmWidget;l.bpmWidget=new Nexus.Number(e,{size:[60,30],value:s.bpm,min:o.bounds.bpm.min,max:o.bounds.bpm.max,step:1}),l.bpmWidget.on("change",e=>{this.running()&&this.stop(),s.bpm!=e&&(s.bpm=e)}),Object.values(document.getElementById(o.domIDs.bpmWidget).children).forEach(e=>{e.style.textAlign="center",e.style.backgroundColor=o.styles.grey,e.style.color=o.styles.black,e.style.fontFamily=o.styles.fontFamily})}})(),(e=>{if(document.getElementById(o.domIDs.container)){const e="#"+o.domIDs.volWidget;l.volumeWidget=new Nexus.Number(e,{size:[60,30],value:s.volume,min:o.bounds.volume.min,max:o.bounds.volume.max,step:1}),l.volumeWidget.on("change",e=>{s.volume!=e&&(s.volume=e,l.synth.volume.value=Tone.gainToDb(s.volume*o.defaults.volumeScale/100))}),Object.values(document.getElementById(o.domIDs.volWidget).children).forEach(e=>{e.style.textAlign="center",e.style.backgroundColor=o.styles.grey,e.style.color=o.styles.black,e.style.fontFamily=o.styles.fontFamily})}})();"object"==typeof e&&this.setOptions(e),document.getElementById(o.domIDs.container)&&(document.getElementById(o.domIDs.container).style.display="none",document.getElementById(o.domIDs.startButton).style.opacity=1,o.domIDs.toggle&&document.getElementById(o.domIDs.toggle).addEventListener("click",e=>this.hidden()?this.show():this.hide()),document.getElementById(o.domIDs.startButton).addEventListener("click",e=>i.event?this.stop():this.start()),n.makeDraggable(document.getElementById(o.domIDs.container)))},generateAPI:e=>{Object.keys(a).forEach(e=>this[e]=a[e]),a=null},load:e=>{(e=>{(e=>{const t=document.createElement("div"),n="kdmetronome--body"===o.domIDs.parentContainer?document.body:document.getElementById(o.domIDs.parentContainer);t.id=o.domIDs.container,n.appendChild(t)})(),(e=>{const t=document.getElementById(o.domIDs.container);t.classList.add(_KDMetronomeInit.cssClassNames.outerContainer),t.innerHTML="<div id='"+o.domIDs.inner+"'></div>"})(),(e=>{const t=document.getElementById(o.domIDs.inner);t.classList.add(_KDMetronomeInit.cssClassNames.innerContainer),t.innerHTML="<button id='"+o.domIDs.startButton+"' class='"+_KDMetronomeInit.cssClassNames.startButton+"' type='button'>off</button><div class='"+_KDMetronomeInit.cssClassNames.bpmWidgetOuter+"'><div id='"+o.domIDs.bpmWidget+"'></div><div class='"+_KDMetronomeInit.cssClassNames.widgetTextLabel+"'>bpm</div></div><div class='"+_KDMetronomeInit.cssClassNames.volWidgetOuter+"'><div id='"+o.domIDs.volWidget+"'></div><div class='"+_KDMetronomeInit.cssClassNames.widgetTextLabel+"'>vol</div></div>"})()})();r.generateAPI(),r.readyCheck()}};r.load()}}